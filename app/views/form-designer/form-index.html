{% extends "layout-govuk-forms.html" %}

{% set pageTitle = 'Add and edit your questions' %}

{% set count = count or 0 %}
{% set countEnd = 0 %}

{% for page in data.pages -%}
  {% if page.group %}{% set countEnd = countEnd + 1 %}{% endif %}
{% endfor %}

{% block pageTitle %}
  {{pageTitle}}: {{ data['formTitle'] }} - GOV.UK Forms
{% endblock %}

{% block beforeContent %}
  <a class="govuk-back-link" href="create-form">Back to {% if data['status'] === 'Live' %}your form{% else %}create a form{% endif %}</a>
{% endblock %}

{% block content %}
  <form id="form" class="form" action="../edit-page/{{ pageId }}" method="post">
    <div class="govuk-grid-row">
      <div class="govuk-grid-column-two-thirds">

        {% if data['status'] === 'Live' %}
        <div class="govuk-notification-banner" role="alert" aria-labelledby="govuk-notification-banner-title" data-module="govuk-notification-banner">
          <div class="govuk-notification-banner__header">
            <h2 class="govuk-notification-banner__title" id="govuk-notification-banner-title">
              Important
            </h2>
          </div>
          <div class="govuk-notification-banner__content">
            <h3 class="govuk-notification-banner__heading">
              Any changes you make to a live form will be updated in the form immediately.
            </h3>
            <p class="govuk-body">
              This could have an impact on people who are filling in the form at the same time. They may lose any answers they have already provided and may need to start again.Â 
            </p>
          </div>
        </div>
        {% endif %}

        <span class="govuk-caption-l">{{ data['formTitle'] }}</span>
        <h1 class="govuk-heading-l govuk-!-margin-bottom-2">{{pageTitle}}</h1>
        {% if data['status'] %}
        <div>
          {{govukTag({
            text: data['status'],
            classes: "govuk-!-margin-bottom-7 govuk-tag--purple" if data['status'] === 'Draft' else "govuk-!-margin-bottom-7 govuk-tag--turquoise"
          })}}
        </div>
        {% endif %}

        {% set nextPageId = data['highestPageId'] | int + 1 %}
        {% set totalPageNum = data['highestPageId'] | int + 2 %}

        {{ govukButton({
          text: "Add a question",
          href: "choose-page-type/" + nextPageId,
          classes: "govuk-!-margin-bottom-7"
        }) }}

      {% if data.pages.length %}

        <h2 class="govuk-heading-m">Your questions</h2>

        <p class="govuk-body govuk-!-margin-bottom-9">
          <a href="/form-designer/page-preview-new-tab/1" target="_blank">Preview the form in a new tab</a>
        <p>

        <dl class="govuk-summary-list">

          {% for page in data.pages -%}

            {% set questionTitle = page["long-title"] or "Page " + page["pageIndex"] %}

            {% if page.group %}
            {% set groupName = '' %}
            {% set groupIndex = 0 %}
            {% for group in data.groups %}
              {% if page.group === group.name %}
                {% set groupName = group.name %}
                {% set groupIndex = loop.index0 %}
              {% endif %}
            {% endfor %}
            {% if count == 0 %}
            <div class="govuk-summary-list__row">
              <section class="app-summary-card">
                <header class="app-summary-card__header">
                  <h2 class="app-summary-card__title">{{groupName}}</h2>
                  <div class="app-summary-card__actions">
                    <ul class="app-summary-card__actions-list">
                    {% if page.pageIndex > 0 %}
                      <li class="app-summary-card__actions-list-item">
                        {{ govukButton({
                          html: "Move up <span class='govuk-visually-hidden'>" + questionTitle + "</span>",
                          classes: "govuk-button--secondary govuk-!-margin-0",
                          href: "reorder-page/" + (page.pageIndex | int + 1) + "/up"
                        }) }}
                      </li>
                    {% endif %}
                    {% if page.pageIndex < data.pages | length - 1 %}
                      <li class="app-summary-card__actions-list-item">
                        {{ govukButton({
                          html: "Move down <span class='govuk-visually-hidden'>" + questionTitle + "</span>",
                          classes: "govuk-button--secondary govuk-!-margin-0",
                          href: "reorder-page/" + (page.pageIndex | int + 1) + "/down"
                        }) }}
                      </li>
                    {% endif %}
                      <li class="app-summary-card__actions-list-item">
                        <a class="govuk-link govuk-link--no-visited-state"href="create-question-group/{{groupIndex | int + 1}}">
                          Edit<span class="govuk-visually-hidden"> {{questionTitle}}</span>
                        </a>
                      </li>
                    </ul>
                  </div>
                </header>

                <div class="app-summary-card__body">
                {% endif %}
                  <div class="govuk-summary-list__row">
                    <dt class="govuk-summary-list__key govuk-!-font-weight-regular">
                      <!--Q{{page["pageIndex"] | int + 1}}.-->
                      {{questionTitle}}
                    </dt>
                    <dd class="govuk-summary-list__actions">
                      <a class="govuk-link govuk-link--no-visited-state"href="edit-page/{{page.pageIndex | int + 1}}">
                        Edit<span class="govuk-visually-hidden"> {{questionTitle}}</span>
                      </a>
                    </dd>
                  </div>
                  {% set count = count + 1 %}
            {% if page.group and count == countEnd %}
                </div>
              </section>
            </div>
            {% endif %}

            {% else %}
            <div class="govuk-summary-list__row">
              <dt class="govuk-summary-list__key govuk-!-font-weight-regular">
                <!--Q{{page["pageIndex"] | int + 1}}.-->
                {{questionTitle}}
              </dt>
              <dd class="govuk-summary-list__actions">
                <div class="govuk-button-group form-action-group govuk-!-margin-bottom-0">
                  <div class="form-actions-reordering">
                  {% if page.pageIndex > 0 %}
                    {{ govukButton({
                        html: "Move up <span class='govuk-visually-hidden'>" + questionTitle + "</span>",
                        classes: "govuk-button--secondary",
                        href: "reorder-page/" + (page.pageIndex | int + 1) + "/up"
                      }) }}
                  {% endif %}

                  {% if page.pageIndex < data.pages | length - 1 %}
                    {{ govukButton({
                        html: "Move down <span class='govuk-visually-hidden'>" + questionTitle + "</span>",
                        classes: "govuk-button--secondary",
                        href: "reorder-page/" + (page.pageIndex | int + 1) + "/down"
                      }) }}
                  {% endif %}
                  </div>
                </div>
                <a class="govuk-link govuk-link--no-visited-state"href="edit-page/{{page.pageIndex | int + 1}}">
                  Edit<span class="govuk-visually-hidden"> {{questionTitle}}</span>
                </a>
              </dd>
            </div>
            {% endif %}

          {%- endfor %}
          </dl>
        {% endif %}

      </div>

    </div>
  </form>

{% endblock %}
