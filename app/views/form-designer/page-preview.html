{% extends "layout-body-only.html" %}

{% block pageTitle %}
  Edit question
{% endblock %}

{% block header %}

{% endblock %}

{% block beforeContent %}
  {% set prevPageId = pageId -1 %}
  <a class="govuk-back-link" href="../edit-page/{{prevPageId}}" target="_parent">Back</a>
{% endblock %}

{% block content %}
<form class="form" action="edit-question-save" method="post">
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">


        {#

        Every field id is prefixed with a unique page id.
        So we can have separate configurations for every page.

        #}



        {% if data["p" + pageId + '-intro-text'] %}

          {# If the page has an intro, set the heading outside of the macros #}
          {# Use the short title as the field label #}
          <h1 class="govuk-heading-l">{{ data["p" + pageId + '-long-title'] }}</h1>
          <p>{{ data["p" + pageId + '-intro-text'] }}</p>
          {% set label = {
            text: data["p" + pageId + '-short-title']
          }%}

        {% else %}

          {# If the page has no intro, set the heading inside of the macros #}
          {# The heading doubles up as the label #}
          {% set label = {
            text: data["p" + pageId + '-long-title'],
            classes: "govuk-label--l",
            isPageHeading: true
          }%}

        {% endif %}


        {# Single line text fields #}
        {% if data["p" + pageId + '-type'] == 'text' and data["p" + pageId + '-unit'] == 'text' %}
        {{ govukInput({
          label: label,
          hint: {text: data["p" + pageId + '-hint-text']},
          id: pageId,
          name: pageId
        }) }}

        {# Currency fields #}
        {% elseif data["p" + pageId + '-type'] == 'text' and data["p" + pageId + '-unit'] == 'pounds' %}
        {{ govukInput({
          label: label,
          hint: {text: data["p" + pageId + '-hint-text']},
          id: pageId,
          name: pageId,
          prefix: {text: "Â£"},
          classes: "govuk-input--width-5",
          spellcheck: false
        }) }}

        {# Weight, distance and length fields #}
        {% elseif data["p" + pageId + '-type'] == 'text'  %}
        {{ govukInput({
          label: label,
          hint: {text: data["p" + pageId + '-hint-text']},
          id: pageId,
          name: pageId,
          suffix: {text: data["p" + pageId + '-unit']},
          classes: "govuk-input--width-5",
          spellcheck: false
        }) }}
        {% endif %}

        {# Textarea with character limit #}
        {% if (data["p" + pageId + '-type'] == 'textarea') and (data["p" + pageId + '-char-limit'] == 'none') %}
        {{ govukTextarea({
          label: label,
          hint: {text: data["p" + pageId + '-hint-text']},
          id: pageId,
          name: pageId
        }) }}
        {% endif %}

        {# Textarea with no character limit #}
        {% if (data["p" + pageId + '-type'] == 'textarea') and not (data["p" + pageId + '-char-limit'] == 'none') %}
        {{ govukCharacterCount({
          name: pageId,
          id: pageId,
          maxlength: data["p" + pageId + '-char-limit'],
          label: label,
          hint: {text: data["p" + pageId + '-hint-text']}
        }) }}
        {% endif %}

        {# Date field #}
        {% if data["p" + pageId + '-type'] == 'date' %}
        {{ govukDateInput({
          id: pageId,
          namePrefix: pageId,
          fieldset: {
            legend: label
          },
          hint: {text: data["p" + pageId + '-hint-text']}
        }) }}
        {% endif %}

        {#
          For radios and checkboxes I'm using straight HTML,
          because I'm not smart enough to loop over the array
          and build an object to stick into a macro.
        #}

        {# Radios #}
        {% if data["p" + pageId + '-type'] == 'radio-checkbox' and data["p" + pageId + '-radios'] %}

        {% set itemsArray = data["p" + pageId + '-item-list'].split('\n') %}

        <div class="govuk-form-group">
          <fieldset class="govuk-fieldset" aria-describedby="question-1-hint">

            {% if not data["p" + pageId + '-intro-text'] %}
            <legend class="govuk-fieldset__legend govuk-fieldset__legend--l">
              <h1 class="govuk-fieldset__heading">
                {{ data["p" + pageId + '-long-title'] }}
              </h1>
            </legend>
            {% endif %}

          <div id="question-1-hint" class="govuk-hint">
            {{ data["p" + pageId + '-hint-text']}}
          </div>
          <div class="govuk-radios">
                {% for item in itemsArray %}
                <div class="govuk-radios__item">
                  <input class="govuk-radios__input" id="question-1-{{ item }}" name="question-1-" type="radio" value="{{ item }}">
                  <label class="govuk-label govuk-radios__label" for="question-1-{{ item }}">
                    {{ item }}
                  </label>
                </div>
                {% endfor %}
          </div>
        </fieldset>
        </div>
        {% endif %}

        {# Checkboxes #}
        {% if data["p" + pageId + '-type'] == 'radio-checkbox' and not data["p" + pageId + '-radios'] %}

        {% set itemsArray = data["p" + pageId + '-item-list'].split('\n') %}

        <div class="govuk-form-group">
          <fieldset class="govuk-fieldset" aria-describedby="question-1-hint">

            {% if not data["p" + pageId + '-intro-text'] %}
            <legend class="govuk-fieldset__legend govuk-fieldset__legend--l">
              <h1 class="govuk-fieldset__heading">
                {{ data["p" + pageId + '-long-title'] }}
              </h1>
            </legend>
            {% endif %}

          <div id="question-1-hint" class="govuk-hint">
            {{ data["p" + pageId + '-hint-text']}}
          </div>
          <div class="govuk-checkboxes">
                {% for item in itemsArray %}
                <div class="govuk-checkboxes__item">
                  <input class="govuk-checkboxes__input" id="question-1-{{ item }}" name="question-1-" type="checkbox" value="{{ item }}">
                  <label class="govuk-label govuk-checkboxes__label" for="question-1-{{ item }}">
                    {{ item }}
                  </label>
                </div>
                {% endfor %}
          </div>
        </fieldset>
        </div>
        {% endif %}

        {# Help text #}
        {% if data["p" + pageId + '-help-text'] %}
        {{ govukDetails({
          summaryText: "Help with this question",
          text: data["p" + pageId + '-help-text']
        }) }}
        {% endif %}

        {# Submit button #}

        {% set nextPageId = pageId | int + 1 %}

        {{ govukButton({
          text: "Continue",
          href: "../edit-page/" + nextPageId,
          attributes: {
            target: "_parent"
          }
        }) }}

    </div>
  </div>
</form>
{% endblock %}
