{% extends "layout-govuk-forms.html" %}

{% set pageTitle -%}
  {% if pageData['long-title'] %}
    {{pageData['long-title']}}
  {% else %}
    Edit question
  {% endif %}
{%- endset %}

{% if pageData['type'] === 'text' %}
{% set answerType = 'Single line of text' %}
{% elif pageData['type'] === 'textarea' %}
{% set answerType = 'Multiple lines of text' %}
{% elif pageData['type'] === 'email' %}
{% set answerType = 'Email address' %}
{% elif pageData['type'] === 'national-insurance-number' %}
{% set answerType = 'National Insurance number' %}
{% elif pageData['type'] === 'phone' %}
{% set answerType = 'Phone number' %}
{% elif pageData['type'] === 'select' %}
{% set answerType = 'One or more selected options from a list' %}
{% elif pageData['type'] === 'yesorno' %}
{% set answerType = 'Yes or no' %}
{% else %}
{% set answerType = pageData['type']|capitalize %}
{% endif %}

{% block pageTitle %}
  {{pageTitle|safe}} - GOV.UK Forms
{% endblock %}

{% block beforeContent %}
  {% if data.referer and ('edit-answer-type' in data.referer) and (pageId === data.referer.split('/') | last) %}
    <a class="govuk-back-link" href="../edit-answer-type/{{pageId}}">Back</a>
  {% else %}
    <a class="govuk-back-link" href="../form-index" target="_parent">Back</a>
  {% endif %}
{% endblock %}

{% block content %}

  <form id="form" class="form" action="../edit-page/{{pageId}}" method="post">
    <div class="govuk-grid-row">
      <div class="govuk-grid-column-two-thirds">

        <span class="govuk-caption-l">Question {{pageId}}</span>
        <h1 class="govuk-heading-l">{{pageTitle|safe}}</h1>

        {% set namePrefix = "pages[" + pageIndex + "]" %}

        <!-- Long question text input -->
        {{ govukInput({
          label: {
            text: "Question text",
            classes: "govuk-label--m"
          },
          hint: {
            text: "Ask a question the way you would in person. For example ‘What is your address?’"
          },
          id: "long-title",
          name: namePrefix + "[long-title]",
          value: pageData['long-title']
        }) }}

        <!-- Hint text input -->
        {{ govukInput({
          label: {
            text: "Hint text (optional)",
            classes: "govuk-label--m"
          },
          hint: {
            text: "Use hint text to help people answer the question. For example, to explain the format the answer should be in, or where to find the information you’ve asked for."
          },
          id: "hint-text",
          name: namePrefix + "[hint-text]",
          value: pageData['hint-text']
        }) }}

        <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible">

        <dl class="govuk-summary-list">
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">
              Answer type
            </dt>
            <dd class="govuk-summary-list__value">
              {{answerType}}
            </dd>
            <dd class="govuk-summary-list__actions">
              <a class="govuk-link govuk-link--no-visited-state" href="/form-designer/edit-answer-type/{{pageIndex + 1}}">
                Change <span class="govuk-visually-hidden">{{pageData['type']}}<span>
              </a>
            </dd>
          </div>
        </dl>

        {% if pageData['type'] === 'select' %}
        <h2 class="govuk-heading-m">Edit your list of options</h2>
        {{ govukCheckboxes({
          idPrefix: "oneOption",
          name: namePrefix + "[oneOption]",
          fieldset: {
            legend: {
              text: "People can only select one option"
            }
          },
          items: [
            {
              value: "oneOption",
              text: "People can only select one option",
              checked: checked(namePrefix + "['oneOption']", "oneOption")
            }
          ]
        }) }}

        {% set optionArray = pageData['item-list'] or [{},{}] %}
        <ol class="govuk-list">
        {% for option in optionArray %}
          {% set optionRow -%}option{{loop.index0}}{%- endset %}
          <li>
            <label class="govuk-label" for="option-{{loop.index0}}">
              Option {{loop.index}}
            </label>
            <input class="govuk-input govuk-input--width-20" id="option-{{loop.index0}}" name="{{namePrefix}}[item-list]" type="text" value="{{pageData['item-list'][loop.index0]}}">
            {{ govukButton({
              text: "Remove",
              name: "action",
              value: "removeOption-" + loop.index0,
              classes: "govuk-button--secondary govuk-!-margin-bottom-3"
            }) }}
          </li>
        {% endfor %}
        </ol>

        {{ govukButton({
          text: "Add another option",
          name: "action",
          value: "addAnother",
          classes: "govuk-button--secondary"
        }) }}
        {% endif %}

        {% set minMaxHtml %}
        <div class="govuk-form-group">
          <fieldset class="govuk-fieldset" role="group" aria-describedby="add-loop-hint">
            <legend class="govuk-fieldset__legend govuk-fieldset__legend--s">
              <h3 class="govuk-fieldset__heading">
                How many times can this question be answered?
              </h3>
            </legend>
            <div class="govuk-date-input" id="add-loop">
              <div class="govuk-date-input__item">
                <div class="govuk-form-group">
                  <label class="govuk-label govuk-date-input__label" for="add-loop-min">
                    Min
                  </label>
                  <input class="govuk-input govuk-date-input__input govuk-input--width-2" id="padd-loop-min" name="{{namePrefix}}[add-loop-min]" type="text" inputmode="numeric" value="{{pageData['add-loop-min']}}">
                </div>
              </div>
              <div class="govuk-date-input__item">
                <div class="govuk-form-group">
                  <label class="govuk-label govuk-date-input__label" for="add-loop-max">
                    Max
                  </label>
                  <input class="govuk-input govuk-date-input__input govuk-input--width-2" id="add-loop-max" name="{{namePrefix}}[add-loop-max]" type="text" inputmode="numeric" value="{{pageData['add-loop-max']}}">
                </div>
              </div>
            </div>

          </fieldset>
        </div>
        {% endset -%}

        <div class="govuk-accordion" data-module="govuk-accordion" id="accordion-with-summary-sections">
          <div class="govuk-accordion__section ">
            <div class="govuk-accordion__section-header">
              <h2 class="govuk-accordion__section-heading">
                <span class="govuk-accordion__section-button" id="accordion-with-summary-sections-heading-1">
                  Add rules to this question
                </span>
              </h2>
              <div class="govuk-accordion__section-summary govuk-body" id="accordion-with-summary-sections-summary-1">
                <p class='govuk-body'>You can make this question repeatable or add it to a group of repeatable questions.</p>
              </div>
            </div>
            <div id="accordion-with-summary-sections-content-1" class="govuk-accordion__section-content" aria-labelledby="accordion-with-summary-sections-heading-1">
              {{ govukRadios({
                idPrefix: "addAnother",
                name: namePrefix + "[addAnother]",
                fieldset: {
                  legend: {
                    text: "Can people answer this question multiple times? (optional)",
                    classes: "govuk-fieldset__legend--m"
                  }
                },
                items: [
                  {
                    value: "individual",
                    text: "Yes, as an individual question",
                    checked: checked(namePrefix + "['addAnother']", "individual"),
                    conditional: {
                      html: minMaxHtml
                    }
                  },
                  {
                    value: "group",
                    text: "Yes, as part of a group",
                    checked: checked(namePrefix + "['addAnother']", "group")
                  },
                  {
                    value: "no",
                    text: "No",
                    checked: checked(namePrefix + "['addAnother']", "no")
                  }
                ]
              }) }}
            </div>
          </div>
        </div>

        <input type="hidden" id="type" name="{{namePrefix}}[type]'" value="{{pageData['type']}}">
        <input type="hidden" id="index" name="{{namePrefix}}[pageIndex]'" value="{{[pageIndex]}}">

        <div class="govuk-button-group">
          {{ govukButton({
            text: "Save and continue",
            name: "action",
            value: "createNextPage"
          }) }}

          {{ govukButton({
            text:  "Save and preview question",
            name: "action",
            value: "update",
            classes: "govuk-button--secondary"
          }) }}
        </div>

        {% if editingExistingQuestion %}
          <div class="govuk-button-group">
            {{ govukButton({
              text: "Delete question",
              classes: "govuk-button--warning",
              name: "action",
              value: "deletePage"
            }) }}
          </div>
        {% endif %}

        <p class="govuk-body">
          <a class="govuk-link govuk-link--no-visited-state" href="../form-index">Go to form overview</a>
        </p>

      </div>

      <div class="govuk-grid-column-one-third">
        <div class="preview-pane-wrapper">
          <h2 class="govuk-heading-m">
            Question preview
          </h2>
          <!-- <a href="../page-preview-new-tab/{{pageId}}" class="govuk-link govuk-link--no-visited-state govuk-!-margin-bottom-4 new-tab-link" target="_blank">Preview question in a new tab</a> -->
          <div class="preview-header">
            <p class="preview-link govuk-body-s">
              <!-- <a href="#" target="_blank" onclick="document.getElementById('form').submit();">Refresh</a> &nbsp;|&nbsp; -->
            </p>
          </div>
          <iframe sandbox="allow-same-origin allow-scripts" title="Page preview" data-module="app-example-frame" class="preview-pane app-example__frame app-example__frame--resizable" src="../page-preview/{{pageId}}" frameborder="1" loading="lazy" id="iFrameResizer0"></iframe>

        </div>
      </div>

    </div>

  </form>

{% endblock %}
